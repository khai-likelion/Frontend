# 프론트엔드 아키텍처 개요 (ARCHITECTURE.md)

이 문서는 **Lovelop 프론트엔드**의 고수준 아키텍처를 설명하며, 복잡한 상태 관리와 인터랙티브 시각화가 어떻게 조화를 이루는지 요약합니다.

## 아키텍처 철학

이 프론트엔드는 구조화된 5단계 사용자 흐름에 최적화된 싱글 페이지 애플리케이션(SPA)으로 구축되었습니다. **상태의 지속성(Persistence)**, **실시간 피드백**, 그리고 **고성능 시각화**에 중점을 둡니다.

## 주요 아키텍처 패턴

### 1. 중앙 집중식 상태 구조 (`App.jsx`)
전통적인 멀티 페이지 앱과 달리, Lovelop은 주요 비즈니스 상태를 최상위 `App` 컴포넌트에서 관리합니다.
- **이유**: 사용자가 단계별로 이동(예: 2단계 진단 보고서 <-> 3단계 시뮬레이션 설정)할 때 생성된 데이터나 선택한 전략이 초기화되지 않도록 하기 위함입니다.
- **관리되는 상태**: `selectedStoreId`, `activeTab`, `xReportData`, `selectedSolutions`, `simJobId`.

### 2. 5단계 사용자 여정 (Pipeline)
UI 아키텍처는 사용자의 경험 단계와 엄격하게 매핑됩니다:
1.  **대시보드 (Dashboard)**: 매장 탐색 및 선택.
2.  **X-Report**: AI 진단 및 전략 "쇼핑" (전략 선택).
3.  **시뮬레이션 설정**: 기간 및 변수 설정.
4.  **시뮬레이션 맵**: Mapbox GL을 통한 에이전트 행동 실시간 시각화.
5.  **Y-Report**: "전"과 "후" 상태의 비교 분석.

### 3. 비동기 작업 폴링(Polling) 핵심부
시뮬레이션과 보고서 생성은 백엔드(Celery)에서 백그라운드로 처리되므로, 프론트엔드는 폴링 전략을 사용합니다.
- **`useJobPolling` 훅**: `jobId`, 간격, 콜백 함수를 인자로 받는 추상화된 로직입니다. 비동기 작업의 진행 상태를 관리하며, 백엔드에서 `completed` 신호를 받으면 자동으로 다음 단계로의 전환을 유도합니다.

### 4. 회복 탄력성 있는 API 통합
`api/` 계층은 무거운 외부 라이브러리 대신 커스텀 `Fetch` 래퍼를 사용합니다.
- **데이터 정규화 (Normalization)**: 모든 API 응답은 정규화 함수를 거칩니다. 이는 서버의 명명 규칙(snake_case)이나 데이터 누락이 UI 컴포넌트의 가동 중단(Crash)으로 이어지지 않도록 방어합니다.
- **에러 인터셉션**: 에러 코드를 가로채어 사용자가 이해할 수 있는 한국어 알림으로 변환합니다.

### 5. 전문화된 시각화 기술
- **지리 공간 (Geospatial)**: `react-map-gl` 및 `mapbox-gl`을 사용하여 실시간으로 이동하는 대규모(최대 160명) 에이전트 마커를 렌더링합니다.
- **데이터 분석 (Analytics)**: `Recharts` 라이브러리를 통해 레이더 차트(감성), 바 차트(매출), 영역 차트(트래픽 피크) 등을 구현했습니다.

## 상호작용 모델

```text
사용자 액션 -> 프론트엔드 API 호출 (POST) -> 백엔드 Job ID 수신 -> useJobPolling 시작 -> 진행률 업데이트 -> 완료 신호 수신 -> 결과 데이터 조회 -> 단계 전환
```

이 모델은 백엔드에서 수 분이 소요되는 복잡한 계산을 수행하는 동안에도 사용자가 UI와 상호작용하며 상태를 확인할 수 있도록 보장합니다.
